<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.10.2/dist/full.min.css" rel="stylesheet" type="text/css"/>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="src/auto_theme.js"></script>
    <script defer src="src/populate_data.js"></script>
    <title>PlayPal - History</title>
    <style>
        .form-select {
            max-height: 20px; 
            overflow: hidden;
            width: 75px;
            margin-right: 1rem;
        }
        .chat-card:hover {
            transform: translateY(20px);
            box-shadow: 0 8px 16px rgba(255, 0, 0, 0.789);
        }

    </style>
</head>
<body>
<div class="navbar bg-base-100">
    <div class="navbar-start">
        <a class="btn btn-ghost text-xl" href="history.html">PlayPal</a>
    </div>
    <div class="navbar-center flex">
        <ul class="menu menu-horizontal px-1">
            <li>
                <label class="flex cursor-pointer gap-2">
                    <svg fill="none" height="20" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                         stroke-width="2" viewBox="0 0 24 24" width="20" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="12" cy="12" r="5"/>
                        <path d="M12 1v2M12 21v2M4.2 4.2l1.4 1.4M18.4 18.4l1.4 1.4M1 12h2M21 12h2M4.2 19.8l1.4-1.4M18.4 5.6l1.4-1.4"/>
                    </svg>
                    <input class="toggle theme-controller" type="checkbox"/>
                    <svg fill="none" height="20" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                         stroke-width="2" viewBox="0 0 24 24" width="20" xmlns="http://www.w3.org/2000/svg">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                </label>
            </li>
        </ul>
    </div>
    <div class="navbar-end">
        <a class="btn" href="new.html">New Chat</a>
    </div>
</div>
</div>
<div class="container mx-auto py-8">
    <h1 class="text-3xl font-bold text-center mb-8 text-primary">Chat History</h1>
    <div class="card">
        <div class="card-body">
            <div class="flex flex-wrap justify-between mb-4">
                <div class="w-full md:w-1/2 mb-4 md:mb-0 text-center">
                    <label for="gameFilter" class="block text-lg font-bold text-text-base">Filter by Game:</label>
                    <select class="select select-primary w-full max-w-xs">
                        <option disabled selected>All Games</option>
                        <option value="minecraft">Minecraft</option>
                        <option value="apex-legends">Apex Legends</option>
                        <option value="league-of-legends">League of Legends</option>
                        <option value="palworld">Palworld</option>
                    </select>
                </div>

                <div class="w-full md:w-1/2 text-center">
                    <label for="aiFilter" class="block text-lg font-bold text-text-base">Filter by AI:</label>
                    <select id="aiFilter" class="select select-primary w-full max-w-xs">
                        <option value="all">All AIs</option>
                        <!-- <option value="coach">AI Coach</option>
                        <option value="buddy">AI Buddy</option>
                        <option value="boyfriend">AI Boyfriend</option>
                        <option value="girlfriend">AI Girlfriend</option>
                        <option value="friend">AI Friend</option>
                        <option value="other">Other</option> -->
                    </select>
                </div>
            <div class="flex flex-wrap -mx-4">
                <div class="w-full md:w-1/2 px-4 mb-4">
                    <a href="chat.html" onclick="localStorage.setItem('currentConversationID', document.getElementById('convID_1').textContent)">  
                        <div class="bg-card rounded-lg p-6 chat-card">
                            <div class="chat-info">
                                <h3 class="text-xl font-bold mb-2 text-primary">Minecraft Train Network</h3>
                                <p class="text-sm text-text-muted">Create Date: Jan 23</p>
                                <p class="text-sm text-text-muted">Last Chat: Feb 06</p>
                            </div>
                            <div class="chat-summary mt-4">
                                <p class="text-sm text-text-muted">We talked about how you implemented your train network in your satisfactory game so that: You have improved iron transportation bandwidth You missed a block and needs to redo everything!</p>
                            </div>
                            <span id="convID_1" style="display: none;">conv_1</span>  
                        </div>
                        </a>
                </div>
                </div>
        </div>
    </div>
</div>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const themeToggle = document.querySelector('.theme-controller');
    const themePref = localStorage.getItem('theme');

    if (themePref) {
      document.documentElement.classList.add(themePref);
    }

    themeToggle.addEventListener('change', () => {
      const currentTheme = document.documentElement.classList.contains('dark') ? 'light' : 'dark';
      document.documentElement.classList.toggle(currentTheme);
      localStorage.setItem('theme', currentTheme);
    });
  });
</script>
</body>
<script>
const personaList = JSON.parse(localStorage.getItem('persona_list')).persona_list;

// const gameFilter = document.getElementById('gameFilter');
const personaFilter = document.getElementById('aiFilter'); 

function sortPersonasByLastChat(a, b) {
  return b.Last_Chat_Date - a.Last_Chat_Date;
}

personaList.sort(sortPersonasByLastChat);

// Populate the game filter base on game data

// Populate the persona filter
personaList.forEach(persona => {
  const option = document.createElement('option');
  option.value = persona.Persona_Name;
  option.text = persona.Persona_Name;
  personaFilter.appendChild(option);
});
</script>

</html>

